@model Telerik.Sitefinity.Frontend.Identity.Mvc.Models.UsersList.UserDetailsViewModel

@using Telerik.Sitefinity;
@using Telerik.Sitefinity.Security.Model;
@using Telerik.Sitefinity.Security.Claims;
@using Telerik.Sitefinity.Frontend.Mvc.Helpers;
@using Telerik.Sitefinity.Frontend.Identity.Mvc.Models.UsersList;

@{
    bool isAuthenticated = false;

    var user = ClaimsManager.GetCurrentIdentity();
    if (user != null)
    {
        isAuthenticated = user.IsAuthenticated;
    }

    Telerik.Sitefinity.Security.UserManager userManager = Telerik.Sitefinity.Security.UserManager.GetManager();
    Telerik.Sitefinity.Security.UserProfileManager userProfileManager = Telerik.Sitefinity.Security.UserProfileManager.GetManager();
    var consultantProfile = userProfileManager.GetUserProfiles((Model.Item.DataItem as SitefinityProfile).User).Where(c => c.GetType().FullName.ToUpper().Contains("CONSULTANTPROFILE")).FirstOrDefault();

    Telerik.Sitefinity.Model.ContentLinks.ContentLink contentLink = (Telerik.Sitefinity.Model.ContentLinks.ContentLink)(Telerik.Sitefinity.Model.DataExtensions.GetValue(consultantProfile, "Banner"));

    Telerik.Sitefinity.Libraries.Model.Image image = null;
    if (contentLink != null)
    {
        image = Telerik.Sitefinity.Modules.Libraries.LibrariesManager.GetManager().GetImage(contentLink.ChildItemId);
    }

}

<div class="@Model.CssClass">

    @if (isAuthenticated)
    {
    <div class="profile-image-holder container">
        @if (image != null)
        { //getting banner image
            <img src="/@image.FilePath" alt="@Model.Item.Fields.FirstName" />
        }
        else
        { //getting profile image
            <div class="profile-photo">
                <img src="@(((SitefinityProfileItemViewModel)Model.Item).AvatarImageUrl)" alt="@Model.Item.Fields.FirstName" />
            </div>
        }

        <h1>@((Model.Item.DataItem as SitefinityProfile).GetUserDisplayName())</h1>

    </div>

    <div class="profile-header-meta">
        <h2>@(Telerik.Sitefinity.Model.DataExtensions.GetValue(consultantProfile, "Position"))</h2>
        <dl class="profile-meta sc-job-meta-group">
            @if (!String.IsNullOrEmpty((string)Telerik.Sitefinity.Model.DataExtensions.GetValue(consultantProfile, "Address")))
            {
                <dd><a href="" title="Location: Sydney"><span class="jn_ico icon-pin"></span>@(Telerik.Sitefinity.Model.DataExtensions.GetValue(consultantProfile, "Address"))</a></dd>
            }
            @if (!String.IsNullOrEmpty((string)Telerik.Sitefinity.Model.DataExtensions.GetValue(consultantProfile, "Phone")))
            {    <dd>
                     <a href="tel:@(Telerik.Sitefinity.Model.DataExtensions.GetValue(consultantProfile, "Phone"))" title="Call me at @(Telerik.Sitefinity.Model.DataExtensions.GetValue(consultantProfile, "Phone"))"><span class="jn_ico icon-phone"></span>@(Telerik.Sitefinity.Model.DataExtensions.GetValue(consultantProfile, "Phone"))</a>
                </dd>
            }
            <dd>
                <a href="" title="Email: @((Model.Item.DataItem as SitefinityProfile).User.Email)"><span class="jn_ico icon-mail"></span>@((Model.Item.DataItem as SitefinityProfile).User.Email)</a>
            </dd>
            @if (!String.IsNullOrEmpty((string)Telerik.Sitefinity.Model.DataExtensions.GetValue(consultantProfile, "url_linkedin")))
            {
                <dd><a href="" title="Linkedin"><span class="jn_ico icon-linkedin"></span>@(Telerik.Sitefinity.Model.DataExtensions.GetValue(consultantProfile, "url_linkedin"))</a></dd>
            }
        </dl>
    </div>

    <div class="profile-body media-body sf-media-body">
        <div class="container">
            <h4>About @Model.Item.Fields.FirstName</h4>
            <p>@Html.HtmlSanitize((((SitefinityProfileItemViewModel)Model.Item).About))</p>


            <div class="h-section">
                @Html.Raw(Telerik.Sitefinity.Model.DataExtensions.GetValue(consultantProfile, "full_bio"))
            </div>
        </div>

    </div>
    }
    else
    {
        <p>@Html.Resource("NotLoggedInUser")</p>
    }
</div>